#!/bin/bash
# Quick command to run Shannon with visible browser and real-time monitoring

set -e

cd ~/shannon

# Get target from args or use default
TARGET_URL="${1:-https://example.com}"
WORKFLOW_ID="shannon-visible-$(date +%s)"
REPO_PATH="repos/visible-demo-$(date +%s)"

echo "=== Shannon Visible Pentest ==="
echo "Target: $TARGET_URL"
echo "Workflow ID: $WORKFLOW_ID"
echo "Repository: $REPO_PATH"
echo

# Create repo
echo "Creating target repository..."
mkdir -p "$REPO_PATH"
cd "$REPO_PATH"
git init >/dev/null 2>&1
git config user.email "shannon@test.com"
git config user.name "Shannon"
echo "# Pentest Target" > README.md
git add . >/dev/null 2>&1
git commit -m "init" >/dev/null 2>&1
cd ~/shannon

echo "âœ“ Repository created: $REPO_PATH"
echo

# Start pentest
echo "Starting pentest with real-time monitoring..."
echo "  Shannon UI: http://localhost:4005"
echo "  Temporal UI: http://localhost:8233/namespaces/default/workflows/$WORKFLOW_ID"
echo

node dist/temporal/client.js \
  "$TARGET_URL" \
  "$REPO_PATH" \
  --workflow-id "$WORKFLOW_ID" \
  --pipeline-testing

echo
echo "=== Pentest Running ==="
echo "Monitor at: http://localhost:4005"
echo "Or query status: node dist/temporal/query.js $WORKFLOW_ID"
echo
